> JPA의 영속성 컨텍스트는 데이터베이스 커넥션을 1:1로 맺는다 

- 커넥션의 시작시점 : 서비스 계층의 트랜젝션이 시작될때 
- 커넥션의 종료시점 : 트랜잭션 종료가 아닌!! API 응답이 반환될때나 뷰템플릿의 렌더링이 이루어질때이다.

> 트랜젝션이 끝나도 연결을 유지하고 있는 이유는 OSIV가 켜져있기 때문이다.

- OSIV ON의 장점  :
   1. 영속성 컨텍스트가 끝까지 유지됨으로 차후에 **지연로딩**을 처리할수 있다. 
   2. 컨트롤러 안에서 이것저것 로직들을 처리할 수 있다.
   
- OSIV ON의 단점 : 
   1. 커넥션을 너무 오래 사용하기 때문에 자원을 많이 잡아먹는다. (커넥션이 마른다.)
   2. 만약 외부 API를 가져와서 쓰는데 종료가 안되면 끊임없이 커넥션을 먹고 있어야 한다. 
   
> 실시간 트래픽이 많은 서비스에서는 OSIV를 꺼야 원활하게 운영이 된다. 

- 그치만 OSIV를 꺼버리면 문제가 있다. 바로 지연로딩을 처리할수 가 없게 된다. 보통 지연로딩은 트랜젝션 외부에서 처리가 되기 때문이다. 

> 따라서 지연로딩 로직을 트랜젝션 내부로 넣어야만 한다. 

```java
 jpa:
    hibernate:
      ddl-auto: create
    properties:
      hibernate:
        #        show_sql: true
        format_sql: true
        default_batch_fetch_size: 100
    open-in-view: false
```

- OSIV 끄는 방법 

```java
@Service
@Transactional(readOnly = true)
public class OrderQueryService {

   ///
}

```
- 별도로 화면에 보여지는 api만을 만들기위한(dto를 지연로딩을 통해 생성해내기 위한) 서비스 계층을 만들어줘야한다!! 

> 아직 기초적인 단계에서는 OSIV ON이 편하게 사실이다. 내가 만드는 서비스가 트래픽이 많은 서비스라면 OSIV OFF를 고려해보자. 
